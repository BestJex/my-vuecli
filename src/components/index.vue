<template>
    <div>
        <!--便签内容框放在最顶部,可清空,可无限扩展-->
        <el-input type="textarea" autosize :placeholder="notePlaceholder" class="textarea" v-model="note"
                  :style="{display:isSee}"
        ></el-input>
        <div class="center" @keyup.enter="enter(keyword)">
            <el-input autofocus id="el-input" style="width: 500px;"
                      @input="input(keyword)"
                      v-model="keyword">
            </el-input>
        </div>
    </div>
</template>

<script>
import axios from 'axios'
var store = {
    /*模式*/
    pattern: '',
    /*便签的默认提示*/
    notePlaceholder: '写点什么吧～～',
    /*便签内容*/
    note: '',
    /*便签是否可见*/
    isSee: 'none',
    /*输入框内容*/
    keyword: '',
}
export default {
    name: 'index',
    data () {
        return store
    },
    methods: {
        //enter激发
        enter: function (keyword) {
            if (keyword != '') {
                var isForward = keyword.startsWith('/')
                /*1.转发模式*/
                if (isForward) {
                    window.location.href = keyword.substring(1)
                } else {
                    this.other(keyword)
                }
            }
        },

        /*由enter()调用,非转发模式*/
        other: function (keyword) {
            var isNote = keyword.startsWith('\'')
            var isCommand = keyword.startsWith(':')
            /*2.便签模式*/
            if (isNote) {
                if (keyword.substring(1) == 'clear ') {
                    store.note = ''
                    store.keyword = '\''
                } else {
                    axios({
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        method: 'post',
                        url: '/note',
                        data: JSON.stringify({
                            'content': keyword.substring(1)
                        }),
                    })
                        .then(function (response) {
                            if (response.data.status == 0) {
                                if (store.note == '') {
                                    store.note = response.data.data.concat('---').concat(new Date().toLocaleString())
                                } else {
                                    store.note += '\n'.concat(response.data.data).concat('---').concat(new Date().toLocaleString())
                                }
                                store.keyword = '\''
                            }
                        })
                        .catch(function (error) {
                            console.log(vueThis.items + '-=================')
                        })
                }
                /*3.命令模式*/
            } else if (isCommand) {
                var vueThis = this
                var index = keyword.indexOf(' ')
                if (index != -1) {
                    var command = keyword.substring(1, index + 1)
                    var isEnd = keyword.lastIndexOf(' ')
                    /*退出功能*/
                    if (isEnd + 1 == keyword.length) {
                        store.pattern = ':' + command
                        if (store.pattern == ':logout ') {
                            axios({
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                method: 'get',
                                url: '/logout'
                            })
                                .then(function (response) {
                                    vueThis.$message(response.data.msg)
                                    setTimeout(function () {
                                            window.location.href = response.data.url
                                        }, 1000
                                    )
                                })
                                .catch(function (error) {
                                    console.log(vueThis.items + '-=================')
                                })
                        } else if ((store.pattern == ':clear ')) {
                            store.note = ''
                        }
                    }
                }
                /*正常搜索*/
            } else {
                axios({
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    method: 'post',
                    url: '/todetail',
                    data: JSON.stringify({
                        'keyword': keyword
                    }),
                })
                    .then(function (response) {
                        window.location.href = 'detail'
                    })
                    .catch(function (error) {
                        console.log(vueThis.items + '-=================')
                    })
            }
        },

        /*输入触发*/
        input: function (keyword) {
            /*是否"开头*/
            var isNote = keyword.startsWith('\'')
            /*是否/开头*/
            var isForward = keyword.startsWith('/')
            /*是否:开头*/
            var isCommand = keyword.startsWith(':')
            /*开启转发模式,什么都不做,不向后台提交数据*/
            if (isForward) {
                /*开启命令模式*/
            } else if (isCommand) {

                /*开启便签模式*/
            } else if (isNote) {
                this.isSee = 'block'
                /*关闭便签模式*/
            } else if (keyword == '') {
                this.isSee = 'none'
                this.article = []
                /*正常模式,提交关键字到后台查询*/
            } else {

            }
        }
    }
}
</script>

<style>
/*输入框水平居中*/
.center {
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
}
</style>
